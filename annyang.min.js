//! annyang
//! version : 1.0.0
//! author  : Tal Ater @TalAter
//! license : MIT
//! https://www.TalAter.com/annyang/
(function(a){"use strict";var b=this,c=b.SpeechRecognition||b.webkitSpeechRecognition||b.mozSpeechRecognition||b.msSpeechRecognition||b.oSpeechRecognition;if(!c)return b.annyang=null,null;var d,e,f,g="en-US",h={start:[],error:[],end:[],result:[],resultMatch:[],resultNoMatch:[],errorNetwork:[],errorPermissionBlocked:[],errorPermissionDenied:[]},i=0,j=!1,k="font-weight: bold; color: #00f;",l=/\s*\((.*?)\)\s*/g,m=/(\(\?:[^)]+\))\?/g,n=/(\(\?)?:\w+/g,o=/\*\w+/g,p=/[\-{}\[\]+?.,\\\^$|#]/g,q=function(a){return a=a.replace(p,"\\$&").replace(l,"(?:$1)?").replace(n,function(a,b){return b?a:"([^\\s]+)"}).replace(o,"(.*?)").replace(m,"\\s*$1?\\s*"),new RegExp("^"+a+"$","i")},r=function(a){a.forEach(function(a){a.callback.apply(a.context)})};b.annyang={init:function(a){e&&e.abort&&e.abort(),e=new c,e.maxAlternatives=5,e.continuous=!0,e.lang=g,e.onstart=function(){r(h.start)},e.onerror=function(a){switch(r(h.error),a.error){case"network":r(h.errorNetwork);break;case"not-allowed":case"service-not-allowed":f=!1,(new Date).getTime()-i<200?r(h.errorPermissionBlocked):r(h.errorPermissionDenied)}},e.onend=function(){if(r(h.end),f){var a=(new Date).getTime()-i;1e3>a?setTimeout(b.annyang.start,1e3-a):b.annyang.start()}},e.onresult=function(a){r(h.result);for(var c,e=a.results[a.resultIndex],f=0;f<e.length;f++){c=e[f].transcript.trim(),j&&b.console.log("Speech recognized: %c"+c,k);for(var g=0,i=d.length;i>g;g++){var l=d[g].command.exec(c);if(l){var m=l.slice(1);return j&&(b.console.log("command matched: %c"+d[g].originalPhrase,k),m.length&&b.console.log("with parameters",m)),d[g].callback.apply(this,m),r(h.resultMatch),!0}}}return r(h.resultNoMatch),!1},d=[],this.addCommands(a)},start:function(b){b=b||{},f=b.autoRestart!==a?!!b.autoRestart:!0,i=(new Date).getTime(),e.start()},abort:function(){f=!1,e.abort()},debug:function(a){j=arguments.length>0?!!a:!0},setLanguage:function(a){g=a,e&&e.abort&&(e.lang=a)},addCommands:function(a){var c,e;for(var f in a)if(a.hasOwnProperty(f)){if(c=b[a[f]]||a[f],"function"!=typeof c)continue;e=q(f),d.push({command:e,callback:c,originalPhrase:f})}j&&b.console.log("Commands successfully loaded: %c"+d.length,k)},removeCommands:function(a){a=Array.isArray(a)?a:[a],d=d.filter(function(b){for(var c=0;c<a.length;c++)if(a[c]===b.originalPhrase)return!1;return!0})},addCallback:function(c,d,e){if(h[c]!==a){var f=b[d]||d;"function"==typeof f&&h[c].push({callback:f,context:e||this})}}}}).call(this);