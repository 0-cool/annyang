// annyang
// version : 0.2.0
// author : Tal Ater
// license : MIT
// TalAter.com
(function(){"use strict";var e=this,t,n,r={start:[],error:[],end:[],result:[],resultMatch:[],resultNoMatch:[]},i=!1,s="font-weight: bold; color: #00f;";if(!("webkitSpeechRecognition"in e)){e.annyang=null;return null}var o=/\((.*?)\)/g,u=/(\(\?)?:\w+/g,a=/\*\w+/g,f=/[\-{}\[\]+?.,\\\^$|#\s]/g,l=function(e){e=e.replace(f,"\\$&").replace(o,"(?:$1)?").replace(u,function(e,t){return t?e:"([^\\s]+)"}).replace(a,"(.*?)");return new RegExp("^"+e+"$","i")},c=function(e){for(var t=0,n=e.length;t<n;t++)e[t].apply(this)};e.annyang={init:function(o){n&&n.abort&&n.abort();n=new webkitSpeechRecognition;n.maxAlternatives=5;n.continuous=!0;n.lang="en-US";n.onstart=function(){c(r.start)};n.onerror=function(){c(r.error)};n.onend=function(){c(r.end)};n.onresult=function(n){c(r.result);var o=n.results[n.resultIndex],u;for(var a=0;a<o.length;a++){u=o[a].transcript.trim();i&&e.console.log("Speech recognized: %c"+u,s);for(var f=0,l=t.length;f<l;f++){var h=t[f].command.exec(u);if(h){var p=h.slice(1);if(i){e.console.log("command matched: %c"+t[f].originalPhrase,s);p.length&&e.console.log("with parameters",p)}t[f].callback.apply(this,p);c(r.resultMatch);return!0}}}c(r.resultNoMatch);return!1};t=[];this.addCommands(o)},start:function(){n.start()},abort:function(){n.abort()},debug:function(e){arguments.length>0?i=!!e:i=!0},setLanguage:function(e){n.lang=e},addCommands:function(n){var r,o;for(var u in n){if(!hasOwnProperty.call(n,u))continue;r=e[n[u]]||n[u];if(typeof r!="function")continue;o=l(u);t.push({command:o,callback:r,originalPhrase:u})}i&&e.console.log("Commands successfully loaded: %c"+t.length,s)},addCallback:function(t,n){if(r[t]===void 0)return;var i=e[n]||n;if(typeof i!="function")return;r[t].push(i)}}}).call(this);